(this["webpackJsonppicture-this-ui"]=this["webpackJsonppicture-this-ui"]||[]).push([[0],{19:function(e,t,n){e.exports=n(38)},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(2),i=n(0),o=n(9),u=n(18),s=n(4),l=document.createElement("canvas"),f=l.getContext("2d"),v=function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r,c,i,o,u,s,v,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}throw new Error("Expected rendering context");case 2:return n=Math.min(t.videoWidth,t.videoHeight),l.width=n,l.height=n,r=(t.videoWidth-n)/2,c=(t.videoHeight-n)/2,i=n,o=n,0,0,u=n,s=n,f.drawImage(t,r,c,i,o,0,0,u,s),v=new Image(n,n),e.next=17,new Promise((function(e){return l.toBlob(e)}));case 17:if(p=e.sent){e.next=20;break}throw new Error("Failed to create blob");case 20:return v.src=URL.createObjectURL(p),e.abrupt("return",v);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(e){return function(){var t=Object(c.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(e);case 2:return r=t.sent,n({type:T,data:{imageSrc:r.src}}),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"environment";return function(){var t=Object(c.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n({type:m}),t.prev=1,"undefined"!==typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia){t.next=4;break}throw new Error("Navigator get user media API not available");case 4:return t.next=6,navigator.mediaDevices.getUserMedia({video:{facingMode:e}});case 6:return r=t.sent,n({type:E}),t.abrupt("return",r);case 11:throw t.prev=11,t.t0=t.catch(1),n({type:g,data:{message:t.t0.message}}),t.t0;case 15:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()},m="REQUEST_CAMERA_START",h=function(e){return e.type===m},E="REQUEST_CAMERA_SUCCESS",b=function(e){return e.type===E},g="REQUEST_CAMERA_ERROR",w=function(e){return e.type===g},O="QUERY_PERMISSION_START",k="QUERY_PERMISSION_SUCCESS",y=function(e){return e.type===k},j="QUERY_PERMISSION_ERROR",C=function(e){return"CHANGE_PERMISSION"===e.type},S="ENUMERATE_DEVICES_START",x="ENUMERATE_DEVICES_SUCCESS",R=function(e){return e.type===x},A="ENUMERATE_DEVICES_ERROR",T="CAPTURE_IMAGE",I=function(e){return e.type===T},N=n(7),U=N.b,_=N.c,D={version:"0.1.0",devices:null,videoInputDeviceCount:null,cameraPermission:null,isRequestingCamera:!1,requestCameraError:null,captures:[]},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;if(h(t))return Object(s.a)(Object(s.a)({},e),{},{isRequestingCamera:!0});if(b(t))return Object(s.a)(Object(s.a)({},e),{},{isRequestingCamera:!1});if(w(t)){var n=t.data.message;return Object(s.a)(Object(s.a)({},e),{},{isRequestingCamera:!1,requestCameraError:n})}if(y(t)||C(t))return Object(s.a)(Object(s.a)({},e),{},{cameraPermission:t.data.state});if(R(t)){var r=t.data.devices,a=r.filter((function(e){return"videoinput"===e.kind})),c=a.length;return Object(s.a)(Object(s.a)({},e),{},{devices:r,videoInputDeviceCount:c})}if(I(t)){var i=t.data.imageSrc;return Object(s.a)(Object(s.a)({},e),{},{captures:[].concat(Object(u.a)(e.captures),[i])})}return e},P=function(e){return e.videoInputDeviceCount},q=function(e){return e.cameraPermission},W=function(e){return e.isRequestingCamera},L=function(e){return e.requestCameraError},B=n(3),H=i.createContext({stream:null,video:null,setStream:function(){}}),Q=function(e){var t=e.stream,n=e.children,r=i.useState(t||null),a=Object(B.a)(r,2),c=a[0],o=a[1],u=i.useRef(document.createElement("video")),s=i.useCallback((function(e){return o(e)}),[]);return i.useEffect((function(){u.current.autoplay=!0,u.current.srcObject=c}),[c]),i.createElement(H.Provider,{value:{stream:c,video:u.current,setStream:s}},n)},F=function(){var e=i.useContext(H);return[e.stream,e.setStream]},G=(n(31),function(){var e=i.useRef(null),t=F(),n=Object(B.a)(t,1)[0];return i.useEffect((function(){var t=e.current;t&&(t.srcObject=n)}),[n]),i.createElement("div",{className:"Camera"},i.createElement("video",{className:"Camera-video",autoPlay:!0,ref:e}))}),J=n(5),V=(n(32),function(e){var t=e.onTouchStart,n=Object(J.a)(e,["onTouchStart"]),r=U(),o=i.useContext(H).video,u=i.useState(!1),s=Object(B.a)(u,2),l=s[0],f=s[1],v=i.useCallback(function(){var e=Object(c.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=2;break}return e.abrupt("return");case 2:if(n.preventDefault(),e.prev=3,o){e.next=6;break}throw new Error("Expected video element");case 6:return e.next=8,r(p(o));case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:f(!0),t&&t(n);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),[l,r,o,t]);return i.useEffect((function(){if(l){var e=setTimeout((function(){return f(!1)}),200);return function(){return clearTimeout(e)}}}),[l]),i.createElement("button",Object.assign({className:"ButtonCapture",onTouchStart:v,disabled:l},n))}),Y=function(e){e.onClick;var t=Object(J.a)(e,["onClick"]),n=U(),r=F(),o=Object(B.a)(r,2)[1],u=function(){var e=Object(c.a)(a.a.mark((function e(t){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,n(d("user"));case 4:r=e.sent,o(r),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return i.createElement("button",Object.assign({onClick:u},t))},z=function(e){e.onClick;var t=Object(J.a)(e,["onClick"]),n=U(),r=F(),o=Object(B.a)(r,2)[1],u=function(){var e=Object(c.a)(a.a.mark((function e(t){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,n(d("environment"));case 4:r=e.sent,o(r),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return i.createElement("button",Object.assign({onClick:u},t))},$=function(e){e.onClick;var t=Object(J.a)(e,["onClick"]),n=F(),r=Object(B.a)(n,2),o=r[0],u=r[1],s=function(){var e=Object(c.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),e.prev=1,o){e.next=4;break}throw new Error("Expected stream");case 4:o.getTracks().forEach((function(e){return e.stop()})),u(null),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return i.createElement("button",Object.assign({onClick:s},t))},K=function(){var e=F(),t=Object(B.a)(e,2),n=t[0],r=t[1];return i.useEffect((function(){var e=function(){document.hidden&&(null===n||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),r(null))};return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)}}),[n,r]),null},X=(n(33),i.forwardRef((function(e,t){var n=i.useRef(null);return i.useImperativeHandle(t,(function(){return{start:function(){var e=n.current;e&&(e.classList.remove("Flash--capture"),e.offsetWidth,e.classList.add("Flash--capture"))}}})),i.createElement("div",{className:"Flash",ref:n})}))),Z=(n(34),function(e){return i.createElement("div",Object.assign({className:"BackgroundEmpty"},e))}),ee=(n(35),function(e){return i.createElement("div",Object.assign({className:"Masking"},e))}),te=(n(36),function(){var e=_(P),t=_(q),n=_(W),r=_(L),a=i.useRef();return i.createElement("div",{className:"App"},i.createElement(K,null),i.createElement(V,{onTouchStart:function(){var e=a.current;e&&e.start()}}),i.createElement("div",{className:"App-controls"},i.createElement("code",null,e," device(s). ",t||"unknown",". ",String(n),". ",r||"none","."),i.createElement("br",null),i.createElement(Y,null,"Request user camera"),i.createElement(z,null,"Request environment camera"),i.createElement($,null,"Close camera")),i.createElement(X,{ref:a}),i.createElement(ee,null),i.createElement(G,null),i.createElement(Z,null))}),ne=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function re(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ae=n(6),ce=n(16),ie=n(17),oe=function(){return document.documentElement.style.setProperty("--vh",.01*window.innerHeight+"px")};window.addEventListener("resize",oe),oe();n(37);var ue=Object(ae.createStore)(M,Object(ce.composeWithDevTools)(Object(ae.applyMiddleware)(ie.a)));Object(c.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue.dispatch(function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:O}),e.prev=1,"undefined"!==typeof navigator.permissions&&"function"===typeof navigator.permissions.query){e.next=4;break}throw new Error("Navigator permission query API not available");case 4:return e.next=6,navigator.permissions.query({name:"camera"});case 6:if(n=e.sent,"denied"===(r=n.state)||"granted"===r||"prompt"===r){e.next=10;break}throw new Error("Unrecognised permission state: "+r);case 10:return t({type:k,data:{state:n.state}}),e.abrupt("return",n);case 14:throw e.prev=14,e.t0=e.catch(1),t({type:j,data:{message:e.t0.message}}),e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}());case 3:(t=e.sent).addEventListener("change",(function(){ue.dispatch({type:"CHANGE_PERMISSION",data:{state:t.state}})})),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))(),Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue.dispatch(function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:S}),e.prev=1,"undefined"!==typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.enumerateDevices){e.next=4;break}throw new Error("Navigator enumerate devices API not available");case 4:return e.next=6,navigator.mediaDevices.enumerateDevices();case 6:return n=e.sent,t({type:x,data:{devices:n}}),e.abrupt("return",n);case 11:throw e.prev=11,e.t0=e.catch(1),t({type:A,data:{message:e.t0.message}}),e.t0;case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})))(),window.addEventListener("unload",(function(){var e=ue.getState(),t=new Blob([JSON.stringify(e)],{type:"application/json; charset=UTF-8"});navigator.sendBeacon("/beacon",t)})),o.render(i.createElement(i.StrictMode,null,i.createElement(N.a,{store:ue},i.createElement(Q,null,i.createElement(te,null)))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/picture-this-ui",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/picture-this-ui","/service-worker.js");ne?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):re(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):re(t,e)}))}}()}},[[19,1,2]]]);
//# sourceMappingURL=main.91da4493.chunk.js.map